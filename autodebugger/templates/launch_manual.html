<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AutoDebugger - Launch Manual Session</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; background: #ffffff; color:#111827; }
    h2 { margin-bottom: 20px; }
    .form-container { max-width: 600px; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: 600; }
    input[type="text"], textarea { 
      width: 100%; 
      padding: 8px; 
      border: 1px solid #ddd; 
      border-radius: 4px; 
      font-family: inherit; 
    }
    textarea { min-height: 100px; font-family: monospace; }
    .help-text { font-size: 12px; color: #666; margin-top: 4px; }
    .btn { 
      padding: 10px 20px; 
      border: 1px solid #ddd; 
      background: white; 
      cursor: pointer; 
      border-radius: 4px; 
      margin-right: 10px;
    }
    .btn:hover { background: #f0f0f0; }
    .btn-primary { 
      background: #3b82f6; 
      color: white; 
      border-color: #2563eb; 
    }
    .btn-primary:hover { background: #2563eb; }
    .status { 
      margin-top: 20px; 
      padding: 10px; 
      border-radius: 4px; 
      display: none; 
    }
    .status.success { 
      background: #10b981; 
      color: white; 
      display: block; 
    }
    .status.error { 
      background: #ef4444; 
      color: white; 
      display: block; 
    }
    .web-control-link {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 15px;
      background: #10b981;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    .web-control-link:hover { background: #059669; }

    /* Dark mode */
    .dark body { background:#0b1020; color:#e5e7eb; }
    .dark input, .dark textarea { 
      background: #1f2937; 
      color: #e5e7eb; 
      border-color: #4b5563; 
    }
    .dark .help-text { color: #9ca3af; }
    .dark .btn { 
      background: #374151; 
      color: #e5e7eb; 
      border-color: #4b5563; 
    }
    .dark .btn:hover { background: #4b5563; }
  </style>
  <script>
    (function(){
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (prefersDark) document.documentElement.classList.add('dark');
    })();
    
    function launchSession(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const statusDiv = document.getElementById('status');
      
      statusDiv.className = 'status';
      statusDiv.textContent = 'Launching...';
      
      fetch('/launch-manual', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          statusDiv.className = 'status error';
          statusDiv.innerHTML = 'Error: ' + data.error;
        } else {
          statusDiv.className = 'status success';
          statusDiv.innerHTML = `
            <div>✓ Session launched successfully!</div>
            <div>Session ID: ${data.session_id}</div>
            <div>Process ID: ${data.pid}</div>
            <div>Command: <code>${data.command}</code></div>
            <a href="http://127.0.0.1:5000" target="_blank" class="web-control-link">
              Open Web Control Interface →
            </a>
          `;
        }
      })
      .catch(error => {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = 'Error: ' + error;
      });
    }
  </script>
</head>
<body>
  <h2>Launch Manual Debugging Session</h2>
  
  <div class="form-container">
    <form onsubmit="launchSession(event); return false;">
      <div class="form-group">
        <label for="script_path">Script Path *</label>
        <input type="text" id="script_path" name="script_path" required 
               placeholder="/path/to/your/script.py" />
        <div class="help-text">Full path to the Python script to debug</div>
      </div>
      
      <div class="form-group">
        <label for="script_args">Script Arguments</label>
        <input type="text" id="script_args" name="script_args" 
               placeholder="--arg1 value1 --arg2 value2" />
        <div class="help-text">Arguments to pass to your script (optional)</div>
      </div>
      
      <div class="form-group">
        <label for="breakpoints">Breakpoints</label>
        <textarea id="breakpoints" name="breakpoints" 
                  placeholder="file.py:10&#10;another_file.py:25&#10;/full/path/to/file.py:42"></textarea>
        <div class="help-text">One breakpoint per line in format: file:line</div>
      </div>
      
      <div class="form-group">
        <button type="submit" class="btn btn-primary">Launch Session</button>
        <a href="/sessions" class="btn">Cancel</a>
      </div>
    </form>
    
    <div id="status" class="status"></div>
  </div>
  
  <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
    <h3>Quick Start</h3>
    <p>To launch a manual debugging session:</p>
    <ol>
      <li>Enter the path to your Python script</li>
      <li>Optionally add command-line arguments</li>
      <li>Optionally set breakpoints (file:line format)</li>
      <li>Click "Launch Session"</li>
      <li>Once launched, open the Web Control Interface to control debugging</li>
    </ol>
    
    <h3>Manual Mode Features</h3>
    <ul>
      <li><strong>Step-by-step execution</strong> - Control each line execution</li>
      <li><strong>Variable inspection</strong> - View all variables at each step</li>
      <li><strong>Function context</strong> - See the current function with audio</li>
      <li><strong>Change tracking</strong> - Monitor variable changes</li>
      <li><strong>Audio narration</strong> - Hear code and changes spoken</li>
      <li><strong>Web interface</strong> - Control from browser at port 5000</li>
    </ul>
  </div>
</body>
</html>